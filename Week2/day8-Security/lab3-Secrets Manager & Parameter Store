

---

# ğŸ§ª Lab: Sá»­ dá»¥ng AWS Secrets Manager & Parameter Store Ä‘á»ƒ quáº£n lÃ½ DB password

## ğŸ¯ Má»¥c tiÃªu

* Táº¡o RDS Database (MySQL/Postgres).
* LÆ°u DB password trong **Secrets Manager** vÃ  **Parameter Store**.
* Viáº¿t Lambda function Ä‘á»ƒ **láº¥y secret** tá»« 2 dá»‹ch vá»¥ nÃ y.
* Thá»­ **rotation tá»± Ä‘á»™ng** vá»›i Secrets Manager.

---

## ğŸªœ CÃ¡c bÆ°á»›c thá»±c hiá»‡n

### **BÆ°á»›c 1: Táº¡o RDS Database**

1. VÃ o **RDS Console** â†’ chá»n **Create database**.
2. Engine: **MySQL** (hoáº·c PostgreSQL).
3. Credential:

   * Username: `admin`
   * Password: chá»n táº¡m thá»i, vÃ­ dá»¥ `MyTempPass123!`
4. Deploy in **us-east-1** (cho dá»… test).
5. Äá»£i database táº¡o xong.



---

### **BÆ°á»›c 2: LÆ°u DB password trong Secrets Manager**

1. VÃ o **AWS Secrets Manager Console** â†’ **Store a new secret**.
2. Secret type: `Credentials for RDS database`.
3. Nháº­p:

   * Username: `admin`
   * Password: `MyTempPass123!`
   * RDS DB instance: chá»n instance vá»«a táº¡o.
4. Äáº·t tÃªn: `MyApp/RDSSecret`.
5. Enable automatic rotation:

   * Táº¡o **Lambda rotation function** (AWS sáº½ auto táº¡o cho báº¡n).
   * Rotation interval: **30 ngÃ y**.

âœ… Giá» DB password sáº½ tá»± rotate khi tá»›i háº¡n.

---

### **BÆ°á»›c 3: LÆ°u DB password trong Parameter Store**

1. VÃ o **Systems Manager** â†’ **Parameter Store** â†’ **Create parameter**.
2. Name: `/MyApp/RDSPassword`
3. Type: **SecureString** (chá»n KMS key default).
4. Value: `MyTempPass123!`
5. Save.

âŒ LÆ°u Ã½: Parameter Store khÃ´ng cÃ³ auto-rotation â†’ báº¡n pháº£i Ä‘á»•i thá»§ cÃ´ng.

---

### **BÆ°á»›c 4: Táº¡o Lambda Ä‘á»ƒ truy cáº­p secret**

1. VÃ o **Lambda Console** â†’ Create function â†’ `Python 3.12`.
2. Trong code Lambda, paste ná»™i dung:

```python
import boto3
import os

def lambda_handler(event, context):
    secret_name = "MyApp/RDSSecret"
    parameter_name = "/MyApp/RDSPassword"
    region_name = "us-east-1"

    # Secrets Manager client
    sm_client = boto3.client('secretsmanager', region_name=region_name)
    # Parameter Store client
    ssm_client = boto3.client('ssm', region_name=region_name)

    # Láº¥y secret tá»« Secrets Manager
    sm_response = sm_client.get_secret_value(SecretId=secret_name)
    sm_secret = sm_response['SecretString']

    # Láº¥y password tá»« Parameter Store
    ssm_response = ssm_client.get_parameter(Name=parameter_name, WithDecryption=True)
    ssm_secret = ssm_response['Parameter']['Value']

    return {
        'SecretsManager': sm_secret,
        'ParameterStore': ssm_secret
    }
```

3. GÃ¡n cho Lambda quyá»n:

   * `SecretsManagerReadWrite`
   * `AmazonSSMReadOnlyAccess`

---

### **BÆ°á»›c 5: Test**

* Run Lambda test â†’ output sáº½ tráº£ vá»:

  * Password tá»« **Secrets Manager** (JSON gá»“m username + password).
  * Password tá»« **Parameter Store** (chá»‰ value string).

---

### **BÆ°á»›c 6: Thá»­ rotation**

* VÃ o **Secrets Manager** â†’ chá»n secret â†’ click **Rotate secret now**.
* AWS sáº½ táº¡o máº­t kháº©u má»›i cho RDS.
* Lambda khi cháº¡y láº¡i â†’ tháº¥y password má»›i tá»« Secrets Manager.
* NhÆ°ng Parameter Store váº«n giá»¯ **máº­t kháº©u cÅ©** (báº¡n pháº£i update thá»§ cÃ´ng).

---

## ğŸ“Œ Káº¿t quáº£ há»c Ä‘Æ°á»£c

* Secrets Manager: **tá»± Ä‘á»™ng rotate**, format JSON, chuyÃªn cho secret.
* Parameter Store: **chá»‰ lÆ°u config**, khÃ´ng rotate, thÃ­ch há»£p lÆ°u settings.

---

